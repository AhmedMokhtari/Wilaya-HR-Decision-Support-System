{% extends 'menu.html' %}
{% block content %}
    {% load static %}
    {% load has_group %}
    <title>{% block title %}  {% endblock %}</title>
    <link href="{% static 'css/absenceajouter.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}"/>
{% if request.user|has_group:"GestionConge" %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/semantic.min.css' %}">
    <style>
    th{
        font-family: "Cairo ExtraLight";
        font-weight: bold;
    }
    h3
    {
        font-weight: bold;
        font-family: "Cairo ExtraLight";
        color: #45B668;
    }
    </style>
    <form class="" id="formsearch">
        <div class="row">
            <div class="col-12 col-lg-12 col-xxl-12 d-flex">
                <div class="card flex-fill">
                    <div class="card-header">
                        <h3 class="text-right">الإطلاع على الرخص</h3>
                        <hr>
                    </div>
                    <div class="card-body">
                        <div class="form-inline justify-content-around p-3">
                            <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-3">
                               <input type="search" id="search" class="form-control " autocomplete="off" placeholder="بحث .....">
                            </div>
                            <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-3">
                                 <div class="dropdown m-3">
                                      <button class="btn btn-primary dropdown-toggle" type="button" id="typeconge" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        نوع
                                      </button>
                                      <div class="dropdown-menu" aria-labelledby="typeconge">
                                        <a class="dropdown-item"onclick="typeCon(this)" >Maladie</a>
                                        <a class="dropdown-item" onclick="typeCon(this)">Normal</a>
                                      </div>
                                    </div>
                                 <div class="dropdown ">
                                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        الحالة
                                      </button>
                                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" onclick="statu(this)" >Terminer</a>
                                        <a class="dropdown-item" onclick="statu(this)" >En Cours</a>
                                        <a class="dropdown-item" onclick="statu(this)">Pas Commencer</a>
                                      </div>
                                    </div>
                            </div>
                            <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-2">
                                <input type="date" id="date1" class="form-control" >
                            </div>
                            <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-2">
                                <input type="date" id="date2" class="form-control" >
                            </div>
                            <div class="form-group col-xs-12 col-sm-6 col-md-4 col-lg-2">
                                <button type="button" onclick="calcDate()" class="btn-search"><i class="fa-solid fa-search"></i></button>
                                 <button type="button" onclick="reseet()" class="btn btn-outline-infos "><i class="fa-solid fa-arrow-rotate-left fa-lg"></i></button>
                            </div>
                        </div>
                        <div>
                            <table id="table" class="table table-hover text-center">
                                <thead style="background-color: #45B668; color: white">
                                      <tr>
                                            <th scope="col">الاسم الكامل</th>
                                            <th scope="col">نوع الإجازة</th>
                                            <th scope="col">تارخ البداية</th>
                                            <th scope="col">تاريخ النهاية</th>
                                            <th scope="col">عدد الأيام</th>
                                            <th scope="col">الحالة</th>
                                      </tr>
                                </thead>
                                <tbody>
                                 {% for cng in conges %}
                                      <tr class="tb-colon">
                                          <td>{{ cng.idpersonnel_field.nomar }} {{  cng.idpersonnel_field.prenomar }}</td>
                                          <td>{{ cng.type_conge }}</td>
                                          <td>{{ cng.datedebut|date:"M d, Y" }}</td>
                                          <td>{{cng.dateretour|date:"M d, Y"}} </td>
                                          <td>{{cng.nbjour}} </td>
                                        {% if cng.statut == 'Pas Commencer' %}
                                           <td><span class="badge badge-primary p-2">Pas Commencer</span></td>
                                        {% elif  cng.statut == 'Terminer' %}
                                               <td><span class="badge badge-success p-2">Terminer</span></td>
                                        {% else %}
                                            <td><span class="badge badge-warning p-2">En Cours</span></td>
                                        {% endif %}
                                      </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script src="{% static 'js/semantic.min.js' %}"></script>
    <script>
    let table = document.getElementById("table");
    function resetTable(){
              let table = document.getElementById("table");
              for(let i=1;i<table.rows.length;i++){
                table.rows[i].removeAttribute("style");
              }
         }
    function reseet(){
          document.getElementById("formsearch").reset();
          resetTable();
             }
    function typeCon(arg){
         reseet();
         for(let i=1;i<table.rows.length;i++){
                 if(table.rows[i].cells[1].textContent!=arg.text){
                   table.rows[i].style.display="none";
                 }
             }
    }
    function statu(arg){
        reseet();
         for(let i=1;i<table.rows.length;i++){
                 if(table.rows[i].cells[5].textContent!=arg.text){
                   table.rows[i].style.display="none";
                 }
             }
    }
    function dateCheck(from,to,check) {
            if((check.getTime() <= to.getTime() && check.getTime() >= from.getTime()-85400000)) {
                // 86,400,000 is 1 day in millisecond
                return true;
            }
            return false;
         }
    function calcDate(){
             let date1=new Date(document.getElementById("date1").value);
             let date2=new Date(document.getElementById("date2").value);
             let table = document.getElementById("table");
             for(let i=1;i<table.rows.length;i++){
                 let val =new Date(table.rows[i].cells[2].innerHTML)
                 if(!(dateCheck(date1,date2,val))){
                   table.rows[i].style.display="none";
                 }
             }
             totalJours();
             justification();
             noJustification();
             totalAbsence();
         }
    $(function() {
			$("#datatables-dashboard-projects").DataTable({
				pageLength: 6,
				lengthChange: false,
				bFilter: false,
				autoWidth: false
			});
		});
    let $rows = $('#table tbody tr');
         $('#search').keyup(function() {
            let val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
            $rows.show().filter(function() {
                let text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                return !~text.indexOf(val);
            }).hide();
        });
    </script>

{% else %}
      <div class="row h-100">
          <div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
            <div class="d-table-cell align-middle">
                <div class="text-center">
                    <h1 class="display-1 font-weight-bold" style="color: red">401</h1>
                    <p class="h1"></p>
                    <p class="h2 font-weight-normal mt-3 mb-4"  style="color: red">ليس لديكم الحق للولوج لهته الصفحة</p>
                    <a href="{% url 'consultation' %}" class="btn btn-primary btn-lg">الرجوع</a>
                </div>
            </div>
        </div>
      </div>
{% endif %}
{% endblock %}