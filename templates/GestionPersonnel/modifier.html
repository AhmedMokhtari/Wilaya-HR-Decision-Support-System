{% extends 'menu.html' %}
{% block content %}
    {% load static %}
    {% block title %}{% endblock title %}
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}"/>
    <script>
     window.onload = function ()
        {
            document.getElementsByClassName('btn btn-secondary sw-btn-prev')[0].innerHTML = "السابق";
            document.getElementsByClassName('btn btn-secondary sw-btn-next')[0].innerHTML = "التالي";
            document.getElementsByClassName('btn-toolbar sw-toolbar sw-toolbar-bottom justify-content-end')[0].setAttribute("dir","ltr")
        }
    </script>
<form method="post">
        {% csrf_token %}
    <div id="smartwizard-default-primary" class="wizard wizard-primary mb-4">
        <ul>
            <li><a href="#default-primary-step-1">Données Personnelles - بيانات شخصية<br><small>تعديل المعلومات</small></a></li>
            <li><a href="#default-primary-step-2">Données Professionnels - بيانات مهنية<br><small>تعديل المعلومات</small></a></li>
            <li><a href="#default-primary-step-3">بيانات إضافية - Données supplémentaires<br><small>تعديل المعلومات</small></a></li>
        </ul>
    <div>
        <div id="default-primary-step-1" class="">
            <div class="row">
                <div class="col-md-6"  style="padding-right:20px; border-left: 1px solid #ccc;">
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="text-center">
                                <div class="mt-2">
                                    <div class="mt-2">
                                        <img src="{% static 'images/genericpersonnel.webp' %}" alt="personnel" id="image" class="rounded-circle img-responsive mt-2" width="164" height="164">
                                        <p>
                                            <input type="file" name="photo" id="photo" onchange="previewPicture(this)"/>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="prenomar">الاسم الشخصي :</label>
                                <input type="text" class="form-control text-center" name="prenomar" value="{{ personnel.prenomar }}" required>
                            </div>

                            <div class="col-md">
                                <label for="prenomfr" class="col-form-label" dir="ltr">Prénom :</label>
                                <input type="text" class="form-control text-center" name="prenomfr" value="{{ personnel.prenomfr }}"  required>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="nomfr"> الاسم العائلي :</label>
                                    <input type="text" class="form-control text-center" name="nomfr" value="{{ personnel.nomfr }}"   required>
                                </div>

                                <div class="col-md">
                                    <label for="nomar" class="col-form-label" dir="ltr">Nom :</label>
                                    <input type="text" class="form-control text-center" name="nomar" value="{{ personnel.nomar }}"  required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="lieunar"> مكان الازدياد :</label>
                                    <input type="text" class="form-control text-center" name="lieunar"  value="{{ personnel.lieunaissancear }}" required>
                                </div>

                                <div class="col-md">
                                    <label for="lieunfr" class="col-form-label" dir="ltr">lieu de naissance :</label>
                                    <input type="text" class="form-control text-center" name="lieunfr" value="{{ personnel.lieunaissancefr }}"  required>
                                </div>
                            </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="cin"> ر.ب.و :</label>
                                <label class="col-form-label" dir="ltr" for="cin">Cin :</label>
                                <input type="text" class="form-control text-center" name="cin" value="{{ personnel.cin }}" required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="daten"> تاريخ الازدياد :</label>
                                <label class="col-form-label" dir="ltr" for="daten">Date de naissance :</label>
                                <input type="date" class="form-control text-center" name="daten" value="{{ personnel.datenaissance|date:'Y-m-d' }}" required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="adressear"> العنوان :</label>
                                <input type="text" class="form-control text-center" name="adressear" value="{{ personnel.adressear }}"  required>
                            </div>

                            <div class="col-md">
                                <label for="adressefr" class="col-form-label" dir="ltr">Adresse :</label>
                                <input type="text" class="form-control text-center" name="adressefr" value="{{ personnel.adressefr }}"  required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="sexe"> الجنس :</label>
                                <label class="col-form-label" dir="ltr" for="sexe">Sexe :</label>
                                <select class="form-control  text-center" name="sexe"   required>
                                    <option {% if personnel.sexe == 'Homme-ذكر' %} selected {% endif %}>Homme-ذكر</option>
                                    <option {% if personnel.sexe == 'Femme-أنثى' %} selected {% endif %}>Femme-أنثى</option>
                                </select>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="situationfar"> الوضع العائلي :</label>
                                <label class="col-form-label" dir="ltr" for="situationfar">Situation familiale :</label>
                                <select class="form-control  text-center" name="situationfar"   required>
                                    <option {% if personnel.situationfamilialefr == 'marié(e)' %} selected {% endif %} value="1">متزوج(ة)-marié(e)</option>
                                    <option {% if personnel.situationfamilialefr == 'divorcé(e)' %} selected {% endif %} value="2">مطلق(ة)-divorcé(e)</option>
                                    <option {% if personnel.situationfamilialefr == 'célibataire(e)' %} selected {% endif %} value="3">بدون-célibataire(e)</option>
                                </select>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="email"> البريد الالكتروني :</label>
                                <label class="col-form-label" dir="ltr" for="email">Email :</label>
                                <input type="text" class="form-control text-center" name="email" value="{{ personnel.email }}"  required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="tele"> الهاتف :</label>
                                <label class="col-form-label" dir="ltr" for="tele">Tele :</label>
                                <input type="text" class="form-control text-center" name="tele" value="{{ personnel.tele }}" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="default-primary-step-2" class="">
            <div class="row">
                <div class="col-md-6" style="padding-right:20px; border-left: 1px solid #ccc;">
                    <div class="card-body">
                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="ppr"> ب,ب.ر :</label>
                                    <label class="col-form-label" dir="ltr" for="ppr">PPR :</label>
                                    <input type="text" class="form-control text-center" name="ppr" value="{{ personnel.ppr }}"  required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="adminiapp"> الإدارة :</label>
                                    <label class="col-form-label" dir="ltr" for="adminiapp">Administration :</label>
                                    <select class="form-control  text-center" name="adminiapp"   required>
                                        <option {% if personnel.administrationapp == 'مجلس عمالة وجدة أنجاد-Préfectoral' %} selected {% endif %}>مجلس عمالة وجدة أنجاد-Préfectoral</option>
                                        <option {% if personnel.administrationapp == 'عمالة وجدة أنجاد-Général' %} selected {% endif %}>عمالة وجدة أنجاد-Général</option>
                                    </select>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="numiden"> الرقم المالي :</label>
                                    <label class="col-form-label" dir="ltr" for="numiden">Numéro d'identification fiscale :</label>
                                    <input type="text" class="form-control text-center" name="numiden" value="{{ personnel.numerofinancier }}" required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="statut"> الحالة :</label>
                                    <label class="col-form-label" dir="ltr" for="statut">Statut :</label>
                                    <input type="text" class="form-control text-center" name="statut" value="{{ personnel.statut }}"  required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="rib"> ر.ي.ب :</label>
                                    <label class="col-form-label" dir="ltr" for="rib">Rib :</label>
                                    <input type="text" class="form-control text-center" name="rib" value="{{personnel.rib}}" pattern="^(0|[1-9][0-9]*)$" required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="ancadmi"> الأقدمية الإدارية :</label>
                                    <label class="col-form-label" dir="ltr" for="ancadmi">Ancienneté administrative :</label>
                                    <input type="text" class="form-control text-center" name="ancadmi" value="{{ personnel.ancienneteadmi }}" required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="daterec"> تاريخ التوظيف :</label>
                                    <label class="col-form-label" dir="ltr" for="daterec">Date de recrutement :</label>
                                    <input type="date" class="form-control text-center" name="daterec" value="{{ personnel.daterecrutement|date:'Y-m-d' }}" required>
                                </div>

                                <div class="col-md">
                                    <label class="col-form-label float-right" for="datedec"> تاريخ الترسيم :</label>
                                    <label class="col-form-label" dir="ltr" for="datedec">Date de démarcation :</label>
                                    <input type="date" class="form-control text-center" name="datedec" value="{{ personnel.datedemarcation|date:'Y-m-d' }}" required>
                                </div>
                            </div>

                    <br>

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="dateretr"> تاريخ الإحالة على التقاعد :</label>
                                    <label class="col-form-label" dir="ltr" for="dateretr">Date de départ à la retraite :</label>
                                     <input type="date" class="form-control text-center" name="dateretr" value="{{ personnel.dateparrainageretraite|date:'Y-m-d' }}" required>
                                </div>
                            </div>

                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card-body">

                            <div class="row">
                                <div class="col-md">
                                    <label class="col-form-label float-right" for="ancadmi"> الأقدمية الإدارية :</label>
                                    <label class="col-form-label" dir="ltr" for="ancadmi">Ancienneté administrative :</label>
                                    <input type="text" class="form-control text-center" name="ancadmi" value="{{ personnel.ancienneteadmi }}" required>
                                </div>
                            </div>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="numcnopsaf"> رفم كنوبس أ.ف :</label>
                                <label class="col-form-label" dir="ltr" for="numcnopsaf">Numéro cnops af :</label>
                                 <input type="text" class="form-control text-center" name="numcnopsaf" value="{{ personnel.numcnopsaf }}" required>
                            </div>

                    <br>

                            <div class="col-md">
                                <label class="col-form-label float-right" for="numcnopsim"> رفم كنوبس أ.م :</label>
                                <label class="col-form-label" dir="ltr" for="numcnopsim">Numéro cnops im :</label>
                                <input type="text" class="form-control text-center" name="numcnopsim" value="{{ personnel.numcnopsim }}" required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="ancadmi"> الأقدمية الإدارية :</label>
                                <label class="col-form-label" dir="ltr" for="ancadmi">Ancienneté administrative :</label>
                                <input type="text" class="form-control text-center" name="ancadmi" value="{{ personnel.ancienneteadmi }}" required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="ancadmi"> الأقدمية الإدارية :</label>
                                <label class="col-form-label" dir="ltr" for="ancadmi">Ancienneté administrative :</label>
                                <input type="text" class="form-control text-center" name="ancadmi" value="{{ personnel.ancienneteadmi }}" required>
                            </div>
                        </div>

                    <br>

                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="dateservice"> تاريخ التكليف :</label>
                                <label class="col-form-label" dir="ltr" for="dateservice">Date d'affectation :</label>
                                 <input type="date" class="form-control text-center" name="dateservice" value="{{ servicepersolast.dateaffectation|date:'Y-m-d' }}" required>
                            </div>

                            <div class="col-md">
                                <label class="col-form-label float-right" for="service"> إدارة :</label>
                                <label class="col-form-label" dir="ltr" for="service">Service :</label>
                                <select class="form-control text-center" name="service"  required>
                                    {% for service in services %}
                                        <option {% if servicelast.idservice == service.idservice %} selected {% endif %} value="{{ service.idservice }}">{{ service.libelleservicefr }} - {{ service.libelleservicear }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <br>
                        <hr>
                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="dategrade"> تاريخ التكليف :</label>
                                <label class="col-form-label" dir="ltr" for="dategrade">Date d'affectation :</label>
                                 <input type="date" class="form-control text-center" name="dategrade" value="{{ gradepersolast.dategrade|date:'Y-m-d' }}" required>
                            </div>

                            <div class="col-md">
                                <label class="col-form-label float-right" for="grade"> المرتبة :</label>
                                <label class="col-form-label" dir="ltr" for="grade">Grade :</label>
                                <select class="form-control text-center" name="grade"  required>
                                    {% for grade in grades %}
                                        <option {% if gradelast.idgrade == grade.idgrade %} selected {% endif %} value="{{ grade.idgrade }}">{{ grade.gradefr }} - {{ grade.gradear }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <br>
                        <hr>
                        <div class="row">
                            <div class="col-md">
                                <label class="col-form-label float-right" for="datefonction"> تاريخ الوظيفة :</label>
                                <label class="col-form-label" dir="ltr" for="datefonction">Date Fonction :</label>
                                 <input type="date" class="form-control text-center" name="datefonction" value="{{ fonctionpersolast.datefonction|date:'Y-m-d'}}" required>
                            </div>

                            <div class="col-md">
                                <label class="col-form-label float-right" for="grade"> الوظيفة :</label>
                                <label class="col-form-label" dir="ltr" for="grade">Fonction :</label>
                                <select class="form-control text-center" name="fonction"  required>
                                    {% for fonction in fonctions %}
                                        <option {% if fonctionlast.idfonction == fonction %} selected {% endif %} value="{{fonction.idfonction}}">{{ fonction.libellefonctionfr }} - {{ fonction.libellefontionar }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-lg-12 col-xxl-12">
                    <div class="card-body">
                    <center><button type="button" class="btn btn-success"  data-toggle="modal" data-target="#defaultModalSuccess" style="font-size: 130%">Enregistrer - حفظ</button></center>
                        <div class="modal fade" id="defaultModalSuccess" tabindex="-1" role="dialog" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Ajout - اضافة</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>
                                    <div class="modal-body m-3">
                                        <p class="mb-0">Confirmer l'ajout d'un personnel - تأكيد اضافة عامل</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">confirmer - تأكيد</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="default-primary-step-3" class="">
            <div class="row">
                <div class="col-md-4">
                    <div>
                    <br>
                        <h5 class="card-title">Conjoint :<span class="float-right">: الزوج</span></h5>
                        <table class="table table-striped text-center">
                        <thead>
                            <tr>
                                <th>Nom Complet</th>
                                <th>الاسم الكامل</th>
                                <th>D-naissance - تاريخ الازدياد</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for conjoint in conjoints %}
                              <tr class="tb-colon"  >
                                <td>{{ conjoint.nomfr }} - {{conjoint.prenomfr}}</td>
                                <td>{{conjoint.nomar}} - {{ conjoint.prenomar }}</td>
                                <td>{{ conjoint.datenaissance|date:'Y-m-d' }}</td>
                                <td><a onclick="red( '/personnel/modifier_conjoint', '{{  conjoint.idconjoint }}')"  class="btn btn-warning btn-icon  mx-1"><i class="fa-solid fa-pen fa-xs mx-1"></i></a> </td>
                              </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    </div>
                <hr>
                </div>

                <div class="col-md-4">
                    <div>
                    <br>
                        <h5 class="card-title">Enfants :<span class="float-right">: الاطفال</span></h5>
                        <table class="table table-striped text-center">
                            <thead>
                                <tr>
                                    <th>Nom Complet</th>
                                    <th>الاسم الكامل</th>
                                    <th>D-naissance - تاريخ الازدياد</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for enfant in enfants %}
                                  <tr class="tb-colon"  >
                                    <td>{{ enfant.nomfr }} - {{enfant.prenomfr}}</td>
                                    <td>{{ enfant.nomar}} - {{ enfant.prenomar }}</td>
                                    <td>{{ personnel.datenaissance|date:'Y-m-d' }}</td>
                                    <td><a  onclick="red( '/personnel/modifier_enfant', '{{ enfant.idenfant }}')" class="btn btn-warning btn-icon  mx-1"><i class="fa-solid fa-pen fa-xs mx-1"></i></a> </td>
                                  </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                <hr>
                </div>

                <div class="col-md-4">
                    <div>
                    <br>
                        <h5 class="card-title">Diplômes :<span class="float-right">: ديبلومات</span></h5>
                        <table class="table table-striped text-center">
                            <thead>
                                <tr>
                                    <th>Diplôme</th>
                                    <th>ديبلوم</th>
                                    <th>التخصص - Spécialité</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for diplome in diplomes %}
                                  <tr class="tb-colon"  >
                                    <td>{{ diplome.diplomefr }}</td>
                                    <td>{{ diplome.diplomear}}</td>
                                    <td>{{ diplome.specialitefr }} - {{ diplome.specialitear }}</td>
                                    <td><a onclick="red( '/personnel/modifier_diplome', '{{ diplome.iddiplome }}')" class="btn btn-warning btn-icon  mx-1"><i class="fa-solid fa-pen fa-xs mx-1"></i></a> </td>
                                  </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                <hr>
                </div>
            </div>
        </div>
    </div>
</div>
</form>
<script>

        $(function() {
			$("#smartwizard-default-primary").smartWizard({
				theme: "default",
				showStepURLhash: false,
			});

			$("#smartwizard-arrows-primary").smartWizard({
				theme: "arrows",
				showStepURLhash: false
			});

			// Validation
			var $validationForm = $("#smartwizard-validation");
			$validationForm.validate({
				errorPlacement: function errorPlacement(error, element) {
					$(element).parents(".form-group").append(
						error.addClass("invalid-feedback small d-block")
					)
				},
				highlight: function(element) {
					$(element).addClass("is-invalid");
				},
				unhighlight: function(element) {
					$(element).removeClass("is-invalid");
				},
				rules: {
					"wizard-confirm": {
						equalTo: "input[name=\"wizard-password\"]"
					}
				}
			});
		});

        var image = document.getElementById("image");

        // La fonction previewPicture
        var previewPicture  = function (e) {

            // e.files contient un objet FileList
            const [picture] = e.files

            // "picture" est un objet File
            if (picture) {
                // On change l'URL de l'image
                image.src = URL.createObjectURL(picture)
            }
         }

        function red (link,val)
        {
            var data = link+"/"+val;
            window.open(data,link,'width=500,height=900');
        }
</script>
{% endblock content %}