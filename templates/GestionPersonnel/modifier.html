{% extends 'menu.html' %}
{% block content %}
    {% load static %}
<form method="post">
        {% csrf_token %}
    <div id="smartwizard-default-primary" class="wizard wizard-primary mb-4">
        <ul>
            <li><a href="#default-primary-step-1">Données Personnelles - بيانات شخصية<br><small>تعديل المعلومات - Modifier les données</small></a></li>
            <li><a href="#default-primary-step-2">Données Professionnels - بيانات مهنية<br><small>تعديل المعلومات - Modifier les données</small></a></li>
            <li><a href="#default-primary-step-3">بيانات إضافية - Données supplémentaires<br><small>تعديل المعلومات - Modifier les données</small></a></li>
        </ul>

    <div>
        <div id="default-primary-step-1" class="">
            <div class="row">
                <div class="col-md-6"  style="padding-right:20px; border-right: 1px solid #ccc;">
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="text-center">
                                <div class="mt-2">
                                    <img src="{% static 'images/genericpersonnel.webp' %}" id="image" class="rounded-circle img-responsive mt-2" width="164" height="164">
                                    <p>
                                        <div class="custom-file" style="width: 10%">
                                            <input type="file" class="custom-file-input" name="photo" id="photo" onchange="previewPicture(this)">
                                            <label class="custom-file-label" for="photo">image</label>
                                        </div>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Prénom :</h5>
                            <input type="text" class="form-control" name="prenomfr" value="{{ personnel.prenomfr }}"   readonly>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title"><span class="float-right">: الاسم الشخصي</span></h5>
                            <input type="text" class="form-control" name="prenomar" value="{{ personnel.prenomar }}"  readonly>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Nom  :</h5>
                            <input type="text" class="form-control" name="nomfr" value="{{ personnel.nomfr }}"   readonly>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title"><span class="float-right">: الاسم العائلي</span></h5>
                            <input type="text" class="form-control" name="nomar" value="{{ personnel.nomar }}"   readonly>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Cin :<span class="float-right">: ر.ب.و</span></h5>
                            <input type="text" class="form-control" name="cin" value="{{ personnel.cin }}"  readonly>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">lieu de naissance :</h5>
                            <input type="text" class="form-control" name="lieunfr" value="{{ personnel.lieunaissancefr }}" required>
                        </div>

                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card-body">
                        <div class="mb-3">
                            <h5 class="card-title"><span class="float-right">: مكان الازدياد</span></h5>
                            <input type="text" class="form-control" name="lieunar" value="{{ personnel.lieunaissancear }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date de naissance :<span class="float-right" >: تاريخ الازدياد</span></h5>
                            <input type="date" class="form-control" name="daten" value="{{ personnel.datenaissance|date:'Y-m-d' }}" required>
                        </div>

                         <div class="mb-3">
                            <h5 class="card-title">Adresse :</h5>
                            <input type="text" class="form-control" name="adressefr" value="{{ personnel.adressefr }}"   required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title"><span class="float-right">: العنوان</span></h5>
                            <input type="text" class="form-control" name="adressear" value="{{ personnel.adressear }}"  required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Situation familiale :</h5>
                            <select class="form-control  text-center" name="situationffr"   required>
                                <option {% if personnel.situationfamilialefr == 'marié(e)' %} selected {% endif %}>marié(e)</option>
                                <option {% if personnel.situationfamilialefr == 'divorcé(e)' %} selected {% endif %}>divorcé(e)</option>
                                <option {% if personnel.situationfamilialefr == 'célibataire(e)' %} selected {% endif %}>célibataire(e)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                                <h5 class="card-title text-right">: الوضع العائلي</h5>
                                <select class="form-control  text-center" name="situationfar"   required>
                                        <option {% if personnel.situationfamilialear == 'متزوج(ة)' %} selected {% endif %}>متزوج(ة)</option>
                                        <option {% if personnel.situationfamilialear == 'مطلق(ة)' %} selected {% endif %}>مطلق(ة)</option>
                                        <option {% if personnel.situationfamilialear == 'بدون' %} selected {% endif %}>بدون</option>
                                    </select>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Tele :<span class="float-right">: الهاتف</span></h5>
                            <input type="text" class="form-control" name="tele" value="{{ personnel.tele }}"  required>
                        </div>

                         <div class="mb-3">
                            <h5 class="card-title">Email :<span class="float-right">: البريد الالكتروني</span></h5>
                            <input type="text"  class="form-control" name="email" value="{{ personnel.email }}" required>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="default-primary-step-2" class="">
            <div class="row">
                <div class="col-md-6" style="padding-right:20px; border-right: 1px solid #ccc;">
                    <div class="card-body">
                        <div class="mb-3">
                            <h5 class="card-title">Numéro d'identification fiscale <span class="float-right">: الرقم المالي</span></h5>
                            <input type="text" class="form-control" name="numiden" value="{{ personnel.numerofinancier }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date de recrutement :<span class="float-right">: تاريخ التوظيف</span></h5>
                            <input type="date" class="form-control" name="daterec" value="{{ personnel.daterecrutement|date:'Y-m-d' }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date de démarcation :<span class="float-right">: تاريخ الترسيم</span></h5>
                            <input type="date" class="form-control" name="datedec" value="{{ personnel.datedemarcation|date:'Y-m-d' }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date de départ à la retraite :<span class="float-right">: تاريخ الإحالة على التقاعد</span></h5>
                            <input type="date" class="form-control" name="dateretr" value="{{ personnel.dateparrainageretraite|date:'Y-m-d' }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Numéro cnopsAf :<span class="float-right">: رفم cnopsAf</span></h5>
                            <input type="text" class="form-control" name="numcnopsaf" value="{{ personnel.numcnopsaf }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Numéro cnopsIm :<span class="float-right">: رفم cnopsIm</span></h5>
                            <input type="text" class="form-control" name="numcnopsim" value="{{ personnel.numcnopsim }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Rib :<span class="float-right">: ر.ي.ب</span></h5>
                            <input type="text" class="form-control" name="rib" pattern="^(0|[1-9][0-9]*)$" value="{{ personnel.rib }}" required>
                        </div>


                        <div class="mb-3">
                            <h5 class="card-title">Ancienneté administrative :<span class="float-right">: الأقدمية الإدارية</span></h5>
                            <input type="text" class="form-control" name="ancadmi" value="{{ personnel.ancienneteadmi }}" required>
                         </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card-body">
                         <div class="mb-3">
                            <h5 class="card-title">Administration App :<span class="float-right">: إدارة</span></h5>
                             <input type="text" class="form-control" name="adminiapp" value="{{ personnel.administrationapp }}" required>
                         </div>
                          <div class="mb-3">
                            <h5 class="card-title">Service :<span class="float-right">: إدارة</span></h5>
                                <select class="form-control text-center" name="service"  required>

                                    {% for service in services %}
                                        <option {% if servicelast.idservice == service.idservice %} selected {% endif %} value="{{ service.idservice }}">{{ service.libelleservicefr }} - {{ service.libelleservicear }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date d'affectation :<span class="float-right">: تاريخ التكليف</span></h5>
                                    <input type="date" class="form-control" name="dateservice" value="{{ servicepersolast.dateaffectation|date:'Y-m-d' }}" required>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Grade :<span class="float-right">: المرتبة</span></h5>
                                     <select class="form-control text-center" name="grade"  required>
                                    {% for grade in grades %}
                                        <option {% if gradelast.idgrade == grade.idgrade %} selected {% endif %} value="{{ grade.idgrade }}">{{ grade.gradefr }} - {{ grade.gradear }}</option>
                                    {% endfor %}
                                </select>
                        </div>

                         <div class="mb-3">
                            <h5 class="card-title">Date d'affectation :<span class="float-right">: تاريخ التكليف</span></h5>
                                    <input type="date" class="form-control" name="dategrade" value="{{ gradepersolast.dategrade|date:'Y-m-d' }}" required>
                         </div>

                        <div class="mb-3">
                            <h5 class="card-title">Fonction :<span class="float-right">: الوظيفة</span></h5>
                            <select class="form-control text-center" name="fonction"  required>
                                {% for fonction in fonctions %}
                                    <option {% if fonctionlast.idfonction == fonction %} selected {% endif %} value="{{fonction.idfonction}}">{{ fonction.libellefonctionfr }} - {{ fonction.libellefontionar }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <h5 class="card-title">Date Fonction :<span class="float-right">: تاريخ الوظيفة</span></h5>
                            <input type="date" class="form-control" name="datefonction" value="{{ fonctionpersolast.datefonction|date:'Y-m-d'}}" required>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-12 col-xxl-12">
                    <div class="card-body">
                    <center><button type="button" class="btn btn-success"  data-toggle="modal" data-target="#defaultModalSuccess"style="font-size: 130%">Enregistrer - حفظ</button></center>
                        <div class="modal fade" id="defaultModalSuccess" tabindex="-1" role="dialog" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Ajout - اضافة</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>
                                    <div class="modal-body m-3">
                                        <p class="mb-0">Confirmer l'ajout d'un personnel - تأكيد اضافة عامل</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">confirmer - تأكيد</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="default-primary-step-3" class="">
            <div class="row">
                <div class="col-md-3">
                    <div>
                        <table class="table table-striped text-center">
                        <thead>
                            <tr>
                                <th>Cin - ر.ب.و</th>
                                <th>Nom Complet</th>
                                <th>الاسم الكامل</th>
                                <th>Tele - هاتف</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for personnel in personnels %}
                              <tr class="tb-colon"  >
                                <td>{{ personnel.cin }}</td>
                                <td>{{ personnel.nomfr }} - {{personnel.prenomfr}}</td>
                                <td>{{personnel.nomar}} - {{ personnel.prenomar }}</td>
                                <td>{{ personnel.tele }}</td>
                                <td><button class="btn btn-info btn-icon m-1 "><i class="fa-solid fa-eye fa-xs m-1 "></i></button><a href><button class="btn btn-warning btn-icon  mx-1"><i class="fa-solid fa-pen fa-xs mx-1"></i></button></a> </td>
                              </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</form>
<script>
        window.onload = function ()
        {
            document.getElementsByClassName('btn btn-secondary sw-btn-prev')[0].innerHTML = "السابق - précédent";
            document.getElementsByClassName('btn btn-secondary sw-btn-next')[0].innerHTML = "التالي - suivant";
        }

        $(function() {
			$("#smartwizard-default-primary").smartWizard({
				theme: "default",
				showStepURLhash: false,
			});

			$("#smartwizard-arrows-primary").smartWizard({
				theme: "arrows",
				showStepURLhash: false
			});

			// Validation
			var $validationForm = $("#smartwizard-validation");
			$validationForm.validate({
				errorPlacement: function errorPlacement(error, element) {
					$(element).parents(".form-group").append(
						error.addClass("invalid-feedback small d-block")
					)
				},
				highlight: function(element) {
					$(element).addClass("is-invalid");
				},
				unhighlight: function(element) {
					$(element).removeClass("is-invalid");
				},
				rules: {
					"wizard-confirm": {
						equalTo: "input[name=\"wizard-password\"]"
					}
				}
			});
			$validationForm
				.smartWizard({
					autoAdjustHeight: false,
					backButtonSupport: false,
					useURLhash: false,
					showStepURLhash: false,
					toolbarSettings: {
						toolbarExtraButtons: [$("<button class=\"btn btn-submit btn-primary\" type=\"button\">Finish</button>")]
					}
				})
				.on("leaveStep", function(e, anchorObject, stepNumber, stepDirection) {
					if (stepDirection === "forward") {
						return $validationForm.valid();
					}
					return true;
				});
			$validationForm.find(".btn-submit").on("click", function() {
				if (!$validationForm.valid()) {
					return;
				}
				alert("Great! The form is valid and ready to submit.");
				return false;
			});
		});

        var image = document.getElementById("image");

                // La fonction previewPicture
                var previewPicture  = function (e) {

                    // e.files contient un objet FileList
                    const [picture] = e.files

                    // "picture" est un objet File
                    if (picture) {
                        // On change l'URL de l'image
                        image.src = URL.createObjectURL(picture)
                    }
                 }
</script>
{% endblock content %}